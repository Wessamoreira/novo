<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="jakarta.faces.html" 
      xmlns:f="jakarta.faces.core" 
      xmlns:ui="jakarta.faces.facelets"  
      xmlns:p="http://primefaces.org/ui" 
      xmlns:otm="http://java.sun.com/jsf/composite/otm"
      xmlns:otm3="http://www.otimize-ti.com.br">
<h:head>
    <title><ui:insert name="tituloPagina"></ui:insert><ui:insert name="tituloNavegador"></ui:insert></title>
    <meta name="keywords" content="SEI, OTIMIZE-TI, SOFTWARE, EDUCACIONAL" />
    <meta name="description" content="SEI - Sistema Educacional Intregrado" />
    <meta name="author" content="Otimize-TI" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, OPTIONS, PUT, PATCH, DELETE" />
    <meta http-equiv="Access-Control-Allow-Headers" content="Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers" />
    
    <ui:include src="/templates/cssVisao.xhtml"></ui:include>
    
    <script src="#{resource['fontawesome/js/all.js']}"></script>
</h:head>

<h:body id="page-top">

    <div id="wrapper">

        <ui:insert name="menu">
            <h:form id="formMenuLateral" styleClass="backMenu menuLateral overflow-x" prependId="false">
                <ui:fragment rendered="#{VisaoAlunoControle.ambienteVisaoAluno}">
                    <ui:include src="/visaoAluno/menuVisaoAluno.xhtml" />
                </ui:fragment>
                <ui:fragment rendered="#{!VisaoAlunoControle.ambienteVisaoAluno}">
                    <ui:include src="/visaoAluno/menuEstudoOnline.xhtml" />
                </ui:fragment>
            </h:form>
        </ui:insert>

        <div id="content-wrapper" class="d-flex flex-column ">
            <div id="content">

                <div class="navbar navbar-expand navbar-light fixed-top shadow border-bottom backTopo" style="height: 50px; border-bottom-size: 2px">
                    <ui:insert name="topo">
                        <ui:include src="/visaoAluno/topoVisaoAluno.xhtml" />
                    </ui:insert>
                </div>

                <h:panelGroup layout="block" styleClass="container-fluid " style="margin-top: 60px" id="pgConteudo">

                    <h:panelGroup id="titulo" layout="block" styleClass=" mb-3 border-bottom border-dark row">
                        <h:panelGroup layout="block" styleClass="col-md-12">
                            <h1 class="#{LoginControle.appMovel ? 'h5 pl-3' :'h4'} mb-0 pb-2 w-100">
                                <ui:insert name="tituloPagina">
                                </ui:insert>
                            </h1>
                        </h:panelGroup>

                        <h:panelGroup layout="block" styleClass="col-md-12">
                            <ui:insert name="subTituloPagina">
                            </ui:insert>
                        </h:panelGroup>
                    </h:panelGroup>

                    <div id="conteudo" style="margin-top: 0px; width: 100%">
                        <ui:include src="../../ajaxStatus.xhtml" />
                        
                        <ui:include src="/templates/javascriptVisao.xhtml"></ui:include>
                        
                        <div id="contentPopup" class="row tabconteudo tabconteudoead">
                            <ui:insert name="conteudo">
                            </ui:insert>
                            
                            <h:panelGroup layout="block" styleClass="row" style="order:1000">
                                <p:growl id="msgFlutuante" showDetail="true" life="5000" globalOnly="true" escape="false" />
                            </h:panelGroup>
                        </div>
                    </div>

                    <div id="rodape">
                        <ui:insert name="rodape">
                           <!-- <ui:include src="../../visaoAdministrativo/template/rodapeVisaoAdministrativa.xhtml" />  --> 
                        </ui:insert>
                    </div>

                </h:panelGroup>
                <footer class="sticky-footer"> </footer>

            </div>
        </div>
    </div>
    
    <a class="scroll-to-top rounded" href="#page-top"> <i class="fas fa-angle-up"></i></a>

    <script type="text/javascript">
        (function($) {
            $(window).ready(function () {
                // ATENÇÃO: Ajustei a lógica EL para usar sessionScope, que é o padrão correto em Facelets
                // Isso mantém sua regra de negócio de redirecionar caso não esteja no contexto correto
                var deveRedirecionar = #{
                    sessionScope['LoginControle'] != null
                    and sessionScope['LoginControle'].usuarioLogado != null
                    and sessionScope['LoginControle'].usuarioLogado.codigo > 0
                    and (sessionScope['LoginControle'].usuarioLogado.isApresentarVisaoAluno == null or !sessionScope['LoginControle'].usuarioLogado.isApresentarVisaoAluno)
                    and (sessionScope['LoginControle'].usuarioLogado.isApresentarVisaoPais == null or !sessionScope['LoginControle'].usuarioLogado.isApresentarVisaoPais)
                    and (!sessionScope['LoginControle'].nomeTelaAtual.contains('conteudoAlunoForm.xhtml') and !sessionScope['LoginControle'].nomeTelaAtual.contains('conteudoAlunoCons.xhtml'))
                };

                if (deveRedirecionar) {
                    // Adicionei o contexto da aplicação para evitar erro de caminho relativo se estiver em subpasta
                    var contextPath = '#{request.contextPath}';
                    window.location.href = contextPath + '/acessoRestrito.xhtml?faces-redirect=true';
                }
                
                // Limpeza do histórico (mantida da original)
                history.pushState(null, null, document.URL);
                window.addEventListener('popstate', function () {
                    history.pushState(null, null, document.URL);
                });
            });
           
        }(jQuery));
    </script>

    <ui:insert name="modal">
    </ui:insert>
    
    <ui:insert name="css">
        <h:form id="formCss">
            <style type="text/css">
                <h:outputText value="#{LoginControle.scriptCssGerado}" escape="false" />
            </style>
        </h:form>
    </ui:insert>

</h:body>
</html>