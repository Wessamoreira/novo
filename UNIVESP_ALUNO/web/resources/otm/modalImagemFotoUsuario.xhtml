<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:p="http://primefaces.org/ui" xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:f="http://java.sun.com/jsf/core"
	  xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:otm="http://java.sun.com/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br" >

<ui:component>

	<c:if test="#{empty id}">
		<c:set var="id" value="panelImagem"></c:set>
	</c:if>
	<c:if test="#{empty formImagem}">
		<c:set var="formImagem" value="formImagem"></c:set>
	</c:if>
	<c:if test="#{empty panelWebCam}">
		<c:set var="panelWebCam" value="modalCapturarImagemWebCamFotoUsuario"></c:set>
	</c:if>
	<c:if test="#{empty form}">
		<c:set var="form" value="form"></c:set>
	</c:if>
	<c:if test="#{empty visaoAluno}">
		<c:set var="visaoAluno" value="false"></c:set>
	</c:if>

	<p:dialog styleClass="modalMaximizado" id="#{id}" widgetVar="#{id}" hideEffect="fade" closeOnEscape="false" closable="true" showEffect="fade" modal="true" draggable="false" focus="btnUpload" onShow="iniciarCrop()">
		<f:facet name="header">
			<h:panelGroup>
				<h:outputText styleClass="field control-label tituloCampos" value="#{msg_aplic.prt_AlterarFoto}" />
			</h:panelGroup>
		</f:facet>
		<h:form id="#{formImagem}" prependId="false">
			<script src="#{resource['script/crop/jquery.Jcrop.js']}" />
			<script type="text/javascript">
					function iniciarCrop() {
						if ($("#foto2").length) {
							$("#foto2").Jcrop({
								onSelect: showCoords,
								onChange: showCoords,
								bgColor: 'black',
								bgOpacity: .3,
								setSelect: [1, 1, 85, 113],
								minSize: [31, 21],
								maxSize: [600, 450]
							});
							console.log("Jcrop criado com sucesso");

						}
					}
				function showCoords(c) {
					var valorX = document.getElementById('x');
					valorX.value = c.x;

					var valorY = document.getElementById('y');
					valorY.value = c.y;

					var valorW = document.getElementById('w');
					valorW.value = c.w;

					var valorH = document.getElementById('h');
					valorH.value = c.h;
				}
			</script>
			<h:panelGroup layout="block" styleClass="row border-bottom mb10 pb10">

				<h:panelGroup layout="block" styleClass="col-md-12 pn text-center" rendered="#{!visaoAluno}">

					<otm:commandIcon id="btnZoomIn" style="margin-left: 10px" rendered="#{bean.exibirBotao}" action="#{bean.executarZoomIn}" icon="#{msg_botoes.btn_icon_zoomPlus_embutido} fs18" update="#{formImagem}" oncomplete="iniciarCrop()" />
					<otm:commandIcon id="btnZoomOut" style="margin-left: 10px" rendered="#{bean.exibirBotao}" action="#{bean.executarZoomOut}" icon="#{msg_botoes.btn_icon_zoomMinus_embutido} fs18" update="#{formImagem}" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnGirarEsquerda" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_esquerda_embutido} fs18" action="#{bean.rotacionar90GrausParaEsquerda}" update="#{formImagem}" tooltip="Girar 90º para Esquerda" oncomplete="iniciarCrop()" />
					<otm:commandIcon id="btnGirarDireita" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_direita_embutido} fs18" action="#{bean.rotacionar90GrausParaDireita}" update="#{formImagem}" tooltip="Girar 90º para Direita" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnGirar180" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_180_embutido} fs18" action="#{bean.rotacionar180Graus}" update="#{formImagem}" tooltip="Girar 180º" oncomplete="iniciarCrop()"/>

				</h:panelGroup>

				<h:panelGroup layout="block" styleClass="col-md-12 pn text-center" rendered="#{visaoAluno}">
					<otm:commandIcon id="btnZoomInVisaoAluno" style="margin-left: 10px" rendered="#{bean.exibirBotao}" action="#{bean.executarZoomIn}" icon="#{msg_botoes.btn_icon_zoomPlus_embutido} fs18" update="#{formImagem}" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnZoomOutVisaoAluno" style="margin-left: 10px" rendered="#{bean.exibirBotao}" action="#{bean.executarZoomOut}" icon="#{msg_botoes.btn_icon_zoomMinus_embutido} fs18" update="#{formImagem}" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnGirarEsquerdaVisaoAluno" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_esquerda_embutido} fs18" action="#{bean.rotacionar90GrausParaEsquerda}" update="#{formImagem}" tooltip="Girar 90º para Esquerda" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnGirarDireitaVisaoAluno" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_direita_embutido} fs18" action="#{bean.rotacionar90GrausParaDireita}" update="#{formImagem}" tooltip="Girar 90º para Direita" oncomplete="iniciarCrop()"/>
					<otm:commandIcon id="btnGirar180VisaoAluno" style="margin-left: 10px" rendered="#{bean.exibirBotao}" icon="#{msg_botoes.btn_icon_girar_180_embutido} fs18" action="#{bean.rotacionar180Graus}" update="#{formImagem}" tooltip="Girar 180º" oncomplete="iniciarCrop()"/>

				</h:panelGroup>
			</h:panelGroup>

			<p:outputPanel rendered="#{bean.exibirBotao}" styleClass="col-md-12 pn text-center" layout="block">
				<h:graphicImage id="foto2" url="#{bean.showFotoCrop}"  />
			</p:outputPanel>

			<h:panelGroup style="display:none" layout="block">
				<h:inputText size="4" id="x" value="#{bean.x}" />
				<h:inputText size="4" id="y" value="#{bean.y}" />
				<h:inputText size="4" id="w" value="#{bean.largura}" />
				<h:inputText size="4" id="h" value="#{bean.altura}" />
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="row" style="overflow: hidden;" rendered="#{bean.exibirUpload}">
				<h:panelGroup layout="block" styleClass="col-md-12 pn">
					<p:fileUpload invalidSizeMessage="Arquivo não Enviado. Tamanho Máximo Permitido #{bean.configuracaoGeralPadraoSistema.tamanhoMaximoUpload}MB."   sizeLimit="#{bean.limiteUpload}"  id="btnUpload" mode="advanced" listener="#{bean.upLoadImagem}" oncomplete="renderizarUpload()" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" cancelIcon="#{msg_botoes.btn_icon_cancelar_embutido}" cancelButtonStyleClass="btn btn-danger" cancelLabel="Cancelar" chooseButtonStyleClass="btn btn-info" chooseButtonTitle="Selecionar Arquivo" auto="true" fileLimit="2000" chooseIcon="#{msg_botoes.btn_icon_selecionar_embutido}" invalidFileMessage="Formato do arquivo inválido, selecionar arquivos com a extensão jpg, jpeg ou png" uploadLabel="Escolher Foto" uploadButtonTitle="Escolher Foto" label="Escolher Foto">
					</p:fileUpload>
					<p:remoteCommand name="renderizarUpload" update="#{formImagem}" action="#{bean.renderizarUpload}" oncomplete="iniciarCrop()" />
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="row" style="margin-top:5px;" rendered="#{bean.exibirUpload}">
				<h:panelGroup layout="block" styleClass="col-md-12 pn">
					<h:outputText styleClass="field control-label tituloCampos" value="Você pode enviar arquivos JPG ou PNG (tamanho máximo de 2MB)" />
				</h:panelGroup>
			</h:panelGroup>


			<h:panelGroup layout="block" styleClass="barra-btn-flutuante-modal-80">
				<p:commandLink styleClass="btn btn-primary" oncomplete="#{bean.oncompleteModal}" rendered="#{bean.exibirBotao}" action="#{bean.recortarFoto}"  value="Confirmar foto" update="#{formImagem}, #{form}" >
					<span class="fas fa-check pull-left" style="margin-right: 0.8em;margin-top:2px;" />
				</p:commandLink>
				<p:commandLink  styleClass="btn btn-info" style="margin-left: 10px" oncomplete="PF('#{panelWebCam}').show(); PF('#{id}').hide()" action="#{bean.resetarCapturaFotoWebCam}" value="Tirar foto" >
					<span class="fa fa-camera pull-left" style="margin-right: 0.8em;margin-top:2px;" />
				</p:commandLink>
				<p:commandLink style="margin-left: 10px" styleClass="btn btn-danger light btn-cancelar" value="Cancelar" action="#{bean.cancelar}" oncomplete="PF('#{id}').hide();" update="#{formImagem}, #{form}" title="Cancelar" >
					<span class="fas fa-ban pull-left" style="margin-right: 0.8em;margin-top:2px;" />
				</p:commandLink>
			</h:panelGroup>

			<h:panelGroup id="panelMensagemModalFotos" layout="block" styleClass="col-md-12 pn">
				<otm:mensagem bean="#{bean}"></otm:mensagem>
			</h:panelGroup>
			<p:growl escape="false" showDetail="true" showSummary="false"  globalOnly="true" ></p:growl>
		</h:form>
	</p:dialog>

</ui:component>

</html>