<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"  xmlns:p="http://primefaces.org/ui" xmlns:otm="http://java.sun.com/jsf/composite/otm"  xmlns:otm2="http://www.otimize-ti.com.br">
<h:panelGroup id="REQUERIMENTO" style="order:#{LoginControle.mapDashboards.get('REQUERIMENTO').ordem}" layout="block" styleClass="col-md-6" rendered="#{PainelGestorAcademicoControle.perfilAcessoPainelRequerimentos and LoginControle.mapDashboards.get('REQUERIMENTO') != null and !LoginControle.mapDashboards.get('REQUERIMENTO').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('REQUERIMENTO')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="REQUERIMENTO_DRAG" dragValue="#{LoginControle.mapDashboards.get('REQUERIMENTO')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardFavoritos" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('REQUERIMENTO').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard" value="#{LoginControle.mapDashboards.get('REQUERIMENTO').titulo}" />
<!-- 			<p:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUERIMENTO'))}" rendered="#{!LoginControle.mapDashboards.get('REQUERIMENTO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('REQUERIMENTO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</p:commandLink> -->
<!-- 			<p:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUERIMENTO'))}" rendered="#{LoginControle.mapDashboards.get('REQUERIMENTO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('REQUERIMENTO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</p:commandLink> -->
<!-- 			<p:commandLink id="ocultarReqs" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUERIMENTO'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('REQUERIMENTO').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</p:commandLink> -->
			<otm:commandIcon action="#{PainelGestorAcademicoControle.inicializarDadosGraficoRequerimento}" status="stsReq" oncomplete="iniciarPollRequerimento()"  render="REQUERIMENTO" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard"  id="btnAtualizarGraficoRequerimento" />

		</ui:define>
		<ui:define name="body">

			


			<h:panelGroup id="painelRequerimentos" styleClass="row scroller-x" rendered="#{PainelGestorAcademicoControle.perfilAcessoPainelRequerimentos and LoginControle.mapDashboards.get('REQUERIMENTO').maximizado}" style="height:300px;overflow-x:auto">
				<a4j:jsFunction limitRender="true" execute="@region" immediate="true" name="validarPoolRequerimentoEncerrado" status="pollRequerimento"  action="#{LoginControle.mapDashboards.get('REQUERIMENTO').encerrarDashboard}"
			oncomplete="#{!LoginControle.mapDashboards.get('REQUERIMENTO').ativado ? 'iniciarCriacaoGraficoRequerimento()' : 'iniciarPollRequerimento()' }" render="#{!LoginControle.mapDashboards.get('REQUERIMENTO').ativado ? 'REQUERIMENTO' : ''}"></a4j:jsFunction>


				<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('REQUERIMENTO').ativado}" 
					styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
						<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
							<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
						</h:panelGroup>
					</h:panelGroup>
					<script type="text/javascript" charset="UTF-8">
					(function($) {
						$.ajaxSetup({
							cache : false
						});
						$.ajax({
							cache : false,
						});
						$(document).ready(function() {
							iniciarPollRequerimento();
						});
						
						 iniciarPollRequerimento = function(){	
	        					if(#{LoginControle.mapDashboards.get('REQUERIMENTO').ativado}){						
	        						setTimeout(validarPoolRequerimentoEncerrado(), 1000);
	        						iniciarCriacaoGraficoRequerimento();
	        					}else{
	        						iniciarCriacaoGraficoRequerimento();
	        					}
	        				};
	        				iniciarCriacaoGraficoRequerimento = function(){	
	        					if(#{!LoginControle.mapDashboards.get('REQUERIMENTO').ativado} &amp;&amp; #{LoginControle.mapDashboards.get('REQUERIMENTO').maximizado} &amp;&amp;  #{!empty PainelGestorAcademicoControle.dadosGrafico}){	
        							criarGraficoRequerimento();
        						}
	        				};
						}(jQuery));
					</script>	
						
			
			<h:panelGroup id="graficoReq" layout="block" rendered="#{!LoginControle.mapDashboards.get('REQUERIMENTO').ativado and !empty PainelGestorAcademicoControle.dadosGrafico}" styleClass="col-md-12" >
					<script type="text/javascript" charset="UTF-8">
					(function($) {
						$.ajaxSetup({
							cache : false
						});
						$.ajax({
							cache : false,
						});
						$(document).ready(function() {
							criarGraficoRequerimento();
						});						
						
						selecionarLegendaRequerimento = function(name){
							var elem = document.getElementById("form:situacaoReq");
							if(name.substring(0, 33) == "Novo - Aguardando Início Execução"){
								elem.value = "PE";
							}
							if(name.substring(0, 11) == "Em Execução"){
								elem.value = "EX";
							}
							if(name.substring(0, 21) == "Finalizado - Deferido"){
								elem.value = "FD";
							}
							if(name.substring(0, 20) == "Aguardando Pagamento"){
								elem.value = "AP";
							}
							if(name.substring(0, 6) == "Isento"){
								elem.value = "IS";
							}
							if(name.substring(0, 23) == "Finalizado - Indeferido"){
								elem.value = "FI";
							}
							if(name.substring(0, 20) == "Pronto para Retirada"){
								elem.value = "PR";
							}
							if(name.substring(0, 8) == "Atrasado"){
								elem.value = "AT";
							}
							fireElement("form:consultar");
						}
						
						criarGraficoRequerimento = function() {
							
							var options = {
								chart : {
									type : 'column',
									renderTo : "form\:graficoReq",														
									height : 300
								},
								credits : {
									enabled : false
								},
								title : {
										text :''
								},
								xAxis: {
					                categories: ['Situação do Requerimento']
					            },
					            yAxis: {
					                min: 0,
					                title: {
					                    text: ''
					                }
					            },
					            tooltip : {
									formatter : function() {
										return '<div class="col-md-12"><b>'
												+ this.series.name
												+ '</b></div>';
									}
								},
					            plotOptions: {
					                column: {
					                    pointPadding: 0.2,
					                    borderWidth: 0,
					                    point : {
											events : {
												click : function(e) {
													click: selecionarLegendaRequerimento(this.series.name)
												},
											}
										},
										events : {
											legendItemClick : function(e) {
												click: selecionarLegendaRequerimento(this.name)
											}
										},
					                }
					            },
								series : [${PainelGestorAcademicoControle.dadosGrafico}]
								
							};
							var chartReq = new Highcharts.Chart(options);
						};
					}(jQuery));
				</script>
			
				
				
				
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{!LoginControle.mapDashboards.get('REQUERIMENTO').ativado and empty PainelGestorAcademicoControle.dadosGrafico}" styleClass="col-md-12 text-center mt50" >
					<h:outputText value="#{msg_aplic.prt_Requerimento_nenhumRequerimentoPendente}" />
				</h:panelGroup>
				<p:commandLink id="consultar" style="display: none" oncomplete="abrirPopupMaximizado2('../academico/requerimentoCons.xhtml?situacao=#{PainelGestorAcademicoControle.situacaoReq}', 'requerimentoCons', 950, 640);"  />
				<h:inputText id="situacaoReq" style="display: none" value="#{PainelGestorAcademicoControle.situacaoReq}"></h:inputText>

			</h:panelGroup>
		</ui:define>
	</otm2:dashpanel>

</h:panelGroup>

</html>
