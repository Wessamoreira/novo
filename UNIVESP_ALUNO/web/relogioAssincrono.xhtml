<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"  xmlns:p="http://primefaces.org/ui" xmlns:otm="http://java.sun.com/jsf/composite/otm">

	<h:outputScript>#{RelogioAssincronoControle.readyScrpitRelogio}</h:outputScript>
	<p:commandLink status="false" render="page-top, formRelogioSessao" id="botaoRelogioAssincrono" oncomplete="#{RelogioAssincronoControle.finalizarSessao()}" />
	<h:outputLink alt="#{msg_menu.Menu_TemporizadorAssincrono}">
		<f:ajax event="click" onevent="funcaoValidaSessao()" />
		<span> <i alt="#{msg_menu.Menu_TemporizadorAssincrono}" class="imoon imoon-clock fields control-label tituloCampos ml10 text-bold fs12" title="#{msg_menu.Menu_TempoSessao}" /> <span id="tempoSessao" class="fields control-label tituloCampos ml10 text-bold fs12 ml-5"></span>
		</span>

	</h:outputLink>
	<script type="text/javascript">
		(function($) {				
				$('body').on('click', function(){					
					funcaoValidaSessao();						
				}
			);	
		}(jQuery));
		//<![CDATA[				
			function ReadyOnclick() {document.getElementById('formRelogioSessao:botaoRelogioAssincrono').click();return false;}
			
			
			
		    function funcaoValidaSessao(){	    	
		    	
			 var TEMPOMAXIMOINATIVO = ("#{session.getMaxInactiveInterval()}")*1000;		 
			 localStorage.setItem("relogiotime", new Date().getTime());
	         var x = setInterval(function() {       
	        
	          var TEMPOLOCALSTORAGE = localStorage.getItem("relogiotime")	        
			  var ULTIMOMILLISEGUNDOLOGADO =  parseInt(TEMPOMAXIMOINATIVO) + parseInt(TEMPOLOCALSTORAGE);
		      var TEMPOAGORA = new Date().getTime();
			  var TEMPORESTANTE = ULTIMOMILLISEGUNDOLOGADO - TEMPOAGORA; 	    
			 
			    var MINUTOS = Math.floor((TEMPORESTANTE / 1000) / 60);
		        var SEGUNDOS = Math.floor((TEMPORESTANTE / 1000) % 60);
		      if (MINUTOS > 0){
				   document.getElementById("tempoSessao").innerHTML = "SUA SESSÃO EXPIRA EM "+ MINUTOS	+ " MIN" ;
				  } else if (SEGUNDOS > 0  ) {
					   document.getElementById("tempoSessao").innerHTML =  "SUA SESSÃO EXPIRA EM "+ SEGUNDOS + " SEG";
					   
					  } else {
						  document.getElementById("tempoSessao").innerHTML = "SESSÃO EXPIRADA";
						  ReadyOnclick();
						  clearInterval(x);
					       }		    
		     }, 1000);	       
		}		 
		//]]>
	</script>
</ui:composition>