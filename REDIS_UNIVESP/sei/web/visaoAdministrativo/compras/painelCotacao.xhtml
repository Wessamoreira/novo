<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://xmlns.jcp.org/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br">

<h:panelGroup id="COTACAO" style="order:#{LoginControle.mapDashboards.get('COTACAO').ordem}" layout="block" styleClass="col-md-6" rendered="#{AplicacaoControle.cliente.permitirAcessoModuloCompras and PainelGestorCompraControle.apresentarEstatisticaCotacaoVO and PainelGestorCompraControle.perfilAcessoPainelCotacaoAguardandoAutorizacao and LoginControle.mapDashboards.get('COTACAO') != null and !LoginControle.mapDashboards.get('COTACAO').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('COTACAO')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="COTACAO_DRAG" dragValue="#{LoginControle.mapDashboards.get('COTACAO')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardCotacoes" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('COTACAO').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard"  value="#{LoginControle.mapDashboards.get('COTACAO').titulo}" />
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('COTACAO'))}" oncomplete="criarGraficoCotacao()" rendered="#{!LoginControle.mapDashboards.get('COTACAO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('COTACAO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('COTACAO'))}" rendered="#{LoginControle.mapDashboards.get('COTACAO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('COTACAO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink id="ocultarCotacaos" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('COTACAO'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('COTACAO').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
			<otm:commandIcon action="#{PainelGestorCompraControle.inicializarDadosEstatisticaCotacao}" status="stsCotacao" oncomplete="iniciarPollCotacao()" render="COTACAO" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard" id="btnAtualizarGraficoCOTACAO" />

		</ui:define>
		<ui:define name="body">
			<h:panelGroup layout="block" styleClass="row scroller-x" rendered="#{LoginControle.mapDashboards.get('COTACAO').maximizado}" style="height:297px;overflow-x:auto">

<a4j:jsFunction  execute="@region" immediate="true" name="validarPoolCotacaoEncerrado" status="pollCotacao"  action="#{LoginControle.mapDashboards.get('COTACAO').encerrarDashboard}"
			oncomplete="#{!LoginControle.mapDashboards.get('COTACAO').ativado ? 'iniciarCriacaoGraficoCotacao()' : 'iniciarPollCotacao()' }" render="#{!LoginControle.mapDashboards.get('COTACAO').ativado ? 'COTACAO' : ''}"></a4j:jsFunction>

		
<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('COTACAO').ativado}" 
					styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
						<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
							<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
						</h:panelGroup>
					</h:panelGroup>
					
					
				<script type="text/javascript" charset="UTF-8">
					(function($) {
						$(document).ready(function() {																		
							iniciarPollCotacao();																								
					});		
		
					iniciarPollCotacao = function(){	
						if(#{LoginControle.mapDashboards.get('COTACAO').ativado}){						
							setTimeout(validarPoolCotacaoEncerrado(), 1000);
							iniciarCriacaoGraficoCotacao();
						}else{
							iniciarCriacaoGraficoCotacao();
						}
					};
					
					iniciarCriacaoGraficoCotacao = function(){	
						if(#{LoginControle.mapDashboards.get('COTACAO').maximizado} &amp;&amp; #{!empty PainelGestorCompraControle.valorGraficoCotacao}){												
							criarGraficoCotacao();
						}
					};
				}(jQuery));
				</script>
				

				<h:panelGroup layout="block" id="chartCotacao" rendered="#{!LoginControle.mapDashboards.get('COTACAO').ativado and !empty PainelGestorCompraControle.valorGraficoCotacao}"  styleClass="col-md-12">
					<script type="text/javascript" charset="UTF-8">
	(function($) {
		$(document).ready(function() {																		
			criarGraficoCotacao();																								
		});		
		
		criarGraficoCotacao = 	function() {
            var options = {
                exporting:{
                    type: 'image/jpeg',
                    buttons:{
                        exportButton:{
                            y:5
                        },
                        printButton:{
                            y:5
                        }
                    }
                },
                legend:{
                    enabled : false,
                    marginTop: 5,
                    style:{
                        fontSize:10
                    }
                },
                title : {
					text :''
				},
                chart : {
                    type : "column",
                    renderTo : "form\:chartCotacao",
                    height:230                                        
                },
                credits : {
                    enabled : false
                },               
                xAxis:{
                    categories:[${PainelGestorCompraControle.valorCategoriaCotacao}]
                },
                yAxis: {
                    title:{
                        text:''
                    },
                    labels: {
                        formatter: function() {
                            return this.value;
                        },
                        style:{
                            fontSize: '10px'
                        }
								        
                    }
                },
                tooltip : {
                    formatter: function() {
                        return this.x +' - '+ this.y;
                    }
                },
                series : [{color:'#ff6f00', data:[${PainelGestorCompraControle.valorGraficoCotacao}]}]
								
            };
            var chartCotacao = new Highcharts.Chart(options);
        }
																											
		}(jQuery));
	</script>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{!LoginControle.mapDashboards.get('COTACAO').ativado  and empty PainelGestorCompraControle.valorGraficoCotacao}"  styleClass="col-md-12 text-center mt50">
					<h:outputText value="Nenhum registro encontrado para a geração deste painel"></h:outputText>
				</h:panelGroup>


				<h:panelGroup id="cotacoes" rendered="#{!LoginControle.mapDashboards.get('COTACAO').ativado and !empty PainelGestorCompraControle.valorGraficoCotacao}"  layout="block" styleClass="col-md-12">
					<rich:dataTable id="dataTableCotacoes" width="100%" cellpadding="0" style="border:none" cellspacing="0" border="none" rowClasses="columnSemBorda" columnClasses="columnSemBorda" value="#{PainelGestorCompraControle.estatisticaCotacaoVO.resumoCronologico}" rows="3" var="linhaCotacao">
						<rich:column>
							<h:outputText styleClass="title1SemBorda" style="" value="#{linhaCotacao.descricao}" />
						</rich:column>
						<rich:column>
							<h:outputText styleClass="title1SemBorda" value="#{linhaCotacao.quantidade}" />
						</rich:column>
					</rich:dataTable>
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
	</otm2:dashpanel>
</h:panelGroup>
</html>