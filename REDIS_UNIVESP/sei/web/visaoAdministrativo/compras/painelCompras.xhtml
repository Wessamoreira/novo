<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://xmlns.jcp.org/jsf/composite/otm" xmlns:cewolf="/WEB-INF/cewolf.tld" xmlns:jsfChart="http://sourceforge.net/projects/jsf-comp" xmlns:otm2="http://www.otimize-ti.com.br">

<h:panelGroup id="RECEBIMENTO_COMPRA" style="order:#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ordem}" layout="block" styleClass="col-md-6" rendered="#{AplicacaoControle.cliente.permitirAcessoModuloCompras and PainelGestorCompraControle.apresentarEstatisticaCompraVO and PainelGestorCompraControle.perfilAcessoPainelComprasAguardandoRecebimento and LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA') != null and !LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="RECEBIMENTO_COMPRA_DRAG" dragValue="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardCompras" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard" value="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').titulo}" />
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA'))}" oncomplete="criarGraficoCompra()" rendered="#{!LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA'))}" rendered="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink id="ocultarComprass" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
			<otm:commandIcon action="#{PainelGestorCompraControle.inicializarDadosEstatisticaCompra}" status="stsCompra" oncomplete="iniciarPollCompra()" render="RECEBIMENTO_COMPRA" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard" id="btnAtualizarGraficoRECEBIMENTO_COMPRA" />

		</ui:define>
		<ui:define name="body">
		
			

			<h:panelGroup layout="block" styleClass="row text-center scroller-x" rendered="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado}" style="height:297px;overflow-x:auto">
			
				<a4j:jsFunction  execute="@region" immediate="true" name="validarPoolCompraEncerrado" status="pollCompra"  action="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').encerrarDashboard}"
			oncomplete="#{!LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado ? 'iniciarCriacaoGraficoCompras()' : 'iniciarPollCompra()' }" render="#{!LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado ? 'RECEBIMENTO_COMPRA' : ''}"></a4j:jsFunction>
				

				<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado}" styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
					<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
						<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
					</h:panelGroup>
				</h:panelGroup>
				<script type="text/javascript" charset="UTF-8">
					(function($) {	
                        $(document).ready(function() {                                                    	
                        	iniciarPollCompra();                        
                        });
                        
                        iniciarPollCompra = function(){	
        					if(#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado}){						
        						setTimeout(validarPoolCompraEncerrado(), 5000);
        						iniciarCriacaoGraficoCompras();
        					}else {        						
        						iniciarCriacaoGraficoCompras();
        					}
        				};
        				
        				iniciarCriacaoGraficoCompras =  function(){
        					if(#{LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').maximizado} &amp;&amp; #{!empty PainelGestorCompraControle.valorGraficoCompra}){        						
    							criarGraficoCompra();
    						}
        				};
        				
  					}(jQuery));
      			</script>
				
				
				<h:panelGroup id="chartCompras" layout="block" rendered="#{!LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado and !empty PainelGestorCompraControle.valorGraficoCompra}" styleClass="col-md-12">
				<script type="text/javascript" charset="UTF-8">
                    (function($) {
                        $(document).ready(function() {                                                    	
                        	criarGraficoCompra();                        
                        });
                                                
                        criarGraficoCompra = 	function() {
                            
                            var options = {
                                exporting:{
                                    type: 'image/jpeg',
                                    buttons:{
                                        exportButton:{
                                            y:5
                                        },
                                        printButton:{
                                            y:5
                                        }
                                    }
                                },
                                legend:{
                                    enabled : false,
                                    marginTop: 5,
                                    style:{
                                        fontSize:10
                                    }
                                },
                                title : {
									text :''
							},
                                chart : {
                                    type : "column",
                                    renderTo : "form\:chartCompras",
                                     height:270
                                                                   },
                                credits : {
                                    enabled : false
                                },
                                xAxis:{
                                    categories: [ ${PainelGestorCompraControle.valorCategoriaCompra}]
                                },
                                yAxis: {
                                    title:{
                                        text:''
                                    },
                                    labels: {
                                        formatter: function() {
                                            return this.value;
                                        },
                                        style:{
                                            fontSize: '10px'
                                        }
												        
                                    }
                                },
                                
                                tooltip : {
                                    formatter: function() {
                                        return this.x +' - '+ this.y;
                                    }
                                },
																										
                                series : [{color:'#ffb300',data:[${PainelGestorCompraControle.valorGraficoCompra}]} ]
												
                            };
                            var chartCompra = new Highcharts.Chart(options);
                        }
																																						
                    }(jQuery));
      </script>
				
				</h:panelGroup>
				<h:panelGroup rendered="#{!LoginControle.mapDashboards.get('RECEBIMENTO_COMPRA').ativado and empty PainelGestorCompraControle.valorGraficoCompra}" styleClass="col-md-12 text-center mt50">
					<h:outputText value="Nenhum registro encontrado para a geração deste painel"></h:outputText>
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
	</otm2:dashpanel>

</h:panelGroup>
</html>