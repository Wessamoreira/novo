<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://xmlns.jcp.org/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br">

<h:panelGroup id="ESTOQUE" style="order:#{LoginControle.mapDashboards.get('ESTOQUE').ordem}" layout="block" styleClass="col-md-6" rendered="#{AplicacaoControle.cliente.permitirAcessoModuloCompras and PainelGestorCompraControle.apresentarEstatisticaProdutoVO and PainelGestorCompraControle.perfilAcessoPainelEstoqueAbaixoMinimo and LoginControle.mapDashboards.get('ESTOQUE') != null and !LoginControle.mapDashboards.get('ESTOQUE').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('ESTOQUE')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="ESTOQUE_DRAG" dragValue="#{LoginControle.mapDashboards.get('ESTOQUE')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardEstoque" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('ESTOQUE').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard" value="#{LoginControle.mapDashboards.get('ESTOQUE').titulo}" />
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('ESTOQUE'))}" rendered="#{!LoginControle.mapDashboards.get('ESTOQUE').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('ESTOQUE').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('ESTOQUE'))}" rendered="#{LoginControle.mapDashboards.get('ESTOQUE').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('ESTOQUE').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink id="ocultarEstoques" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('ESTOQUE'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('ESTOQUE').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
			<otm:commandIcon action="#{PainelGestorCompraControle.inicializarDadosEstatisticaEstoque}" status="stsEstoque" oncomplete="iniciarPollProduto()" render="ESTOQUE" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard" id="btnAtualizarGraficoESTOQUE" />

		</ui:define>
		<ui:define name="body">

			<h:panelGroup layout="block" styleClass="row scroller-x" rendered="#{LoginControle.mapDashboards.get('ESTOQUE').maximizado}" style="height:297px;overflow-x:auto">
				<script type="text/javascript" charset="UTF-8">
	(function($) {
		$(document).ready(function() {																		
			iniciarPollProduto();																								
		});	
		iniciarPollProduto = function(){	
			if(#{LoginControle.mapDashboards.get('ESTOQUE').ativado}){						
				setTimeout(validarPoolProdutoEncerrado(), 1000);			
			}
		}
	}(jQuery));
	</script>

				<a4j:jsFunction  execute="@region" immediate="true" name="validarPoolProdutoEncerrado" status="pollProduto" action="#{LoginControle.mapDashboards.get('ESTOQUE').encerrarDashboard}" oncomplete="#{!LoginControle.mapDashboards.get('ESTOQUE').ativado ? '' : 'iniciarPollProduto()' }" render="#{LoginControle.mapDashboards.get('ESTOQUE').ativado ? '' : 'ESTOQUE'}"></a4j:jsFunction>


				<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('ESTOQUE').ativado}" styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
					<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
						<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
					</h:panelGroup>
				</h:panelGroup>

				<rich:popupPanel styleClass="modalMaximizado" id="panelEstoque">
					<f:facet name="header">
						<h:panelGroup>
							<h:outputText value="Estoques" />
						</h:panelGroup>
					</f:facet>
					<f:facet name="controls">
						<h:panelGroup>
							<h:graphicImage value="#{resource['imagens/close.png']}" styleClass="icon-close-modal" style="cursor:pointer" id="hiperlink">
								<rich:componentControl target="panelEstoque" operation="hide" event="click" />
							</h:graphicImage>
						</h:panelGroup>
					</f:facet>
					<h:panelGroup layout="block" styleClass="row">

						<h:outputText styleClass="title" value="#{PainelGestorCompraControle.descricaoCategoriaUnidadeEnsino}" />

						<h:panelGroup layout="block" styleClass="col-md-12">
							<rich:dataTable id="estoqueVOs" width="100%" headerClass="subordinado" styleClass="tabFormSubordinada" rowClasses="linhaImparSubordinado, linhaParSubordinado" footerClass="tabFooter" columnClasses="colunaAlinhamento" value="#{PainelGestorCompraControle.estoqueVOs}" var="estoques" rows="10">
								<rich:column>
									<f:facet name="header">
										<h:outputText value="Produto" />
									</f:facet>
									<h:outputText id="produtoServicoNome" value="#{estoques.produto.nome}" />
								</rich:column>
								<rich:column>
									<f:facet name="header">
										<h:outputText value="#{msg_aplic.prt_ProdutoServico_estoqueMinimo}" />
									</f:facet>
									<h:outputText id="produtoServicoEstoqueMinimo" value="#{estoques.estoqueMinimo}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</rich:column>
								<rich:column>
									<f:facet name="header">
										<h:outputText value="#{msg_aplic.prt_ProdutoServico_estoqueMaximo}" />
									</f:facet>
									<h:outputText id="produtoServicoEstoqueMaximo" value="#{estoques.estoqueMaximo}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</rich:column>
								<rich:column>
									<f:facet name="header">
										<h:outputText value="#{msg_aplic.prt_ProdutoServico_quantidade}" />
									</f:facet>
									<h:outputText id="produtoServicoQuantidade" value="#{estoques.quantidade}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</rich:column>
								<f:facet name="footer">
									<div style="text-align: center !important">
										<rich:dataScroller resetValues="true" limitRender="true" boundaryControls="auto" stepControls="auto" fastControls="hide" align="center" for="estoqueVOs" />
									</div>
								</f:facet>
							</rich:dataTable>
						</h:panelGroup>
					</h:panelGroup>

				</rich:popupPanel>
				<h:panelGroup layout="block" rendered="#{!LoginControle.mapDashboards.get('ESTOQUE').ativado}" styleClass="row text-center">
					<h:outputText styleClass="col-md-12 btn-block mt50" rendered="#{empty PainelGestorCompraControle.estatisticaEstoqueVO.resumoEstatisticaEstoqueCategoriaProdutoVO}" value="Nenhum registro encontrado para a geração deste painel"></h:outputText>
					<rich:dataGrid type="definitions" columns="#{LoginControle.appMovel ? '1' : '3'}" style="border:none !important" styleClass="row" id="dataTableEstoque" rendered="#{!empty PainelGestorCompraControle.estatisticaEstoqueVO.resumoEstatisticaEstoqueCategoriaProdutoVO}" value="#{PainelGestorCompraControle.estatisticaEstoqueVO.resumoEstatisticaEstoqueCategoriaProdutoVO}" rows="6" var="categoriaEstoque">
						<h:panelGroup layout="block" styleClass="col-md-12">
							<otm2:panel name="prod#{categoriaEstoque.codigoCategoriaProduto}" stylePanel="min-height:80px"  styleHeader="min-height:25px; max-height:25px;text-align:left" styleBody="min-height:35px" renderedControl="false" styleClassFooter="pt5">
								<ui:define name="header">
									<h:outputText styleClass="text-info fs10" value="#{categoriaEstoque.nomeCategoriaProduto}" />
								</ui:define>
								<ui:define name="body">
									<h:panelGroup layout="block" styleClass="col-md-12 text-center mt20">
										<a4j:commandLink id="quantidadeUnitariaProdutoAbaixoMinimo" title="Visualizar Estoques" action="#{PainelGestorCompraControle.consultarEstoques}" render="panelEstoqueLista" oncomplete="#{rich:component('panelEstoque')}.show();">
											<h:outputText styleClass="text-danger fs30 " value="#{categoriaEstoque.quantidadeUnitariaProdutoAbaixoMinimo}" />
										</a4j:commandLink>
										<h:outputText styleClass="text-info btn-block text-center fs10 mt5" value="#{categoriaEstoque.nomeUnidadeEnsino}" />
									</h:panelGroup>
								</ui:define>
								<ui:define name="footer">
									<h:panelGroup layout="block" styleClass="col-md-12 text-center">
										<h:outputText styleClass="fs10" value="Qtde Produto: #{categoriaEstoque.quantidadeProduto}" />
									</h:panelGroup>
								</ui:define>
							</otm2:panel>
						</h:panelGroup>

						<f:facet name="footer">
							<rich:dataScroller maxPages="5" boundaryControls="auto" fastControls="hide" stepControls="auto" for="dataTableEstoque" limitRender="true" align="center" />
						</f:facet>
					</rich:dataGrid>
				</h:panelGroup>
			</h:panelGroup>

		</ui:define>
	</otm2:dashpanel>
</h:panelGroup>


</html>