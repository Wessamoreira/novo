<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://xmlns.jcp.org/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br">

<h:panelGroup id="REQUISICAO_PENDENTE_AUTORIZACAO" style="order:#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ordem}" layout="block" styleClass="col-md-6" rendered="#{AplicacaoControle.cliente.permitirAcessoModuloCompras and PainelGestorCompraControle.apresentarEstatisticaRequisicaoVO and PainelGestorCompraControle.perfilAcessoPainelRequisicoesAguardandoAutorizacao and LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO') != null and !LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="REQUISICAO_PENDENTE_AUTORIZACAO_DRAG" dragValue="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardRequisicoes" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard" value="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').titulo}" />
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO'))}" oncomplete="criarGraficoRequisicao()" rendered="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO'))}" rendered="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink id="ocultarREQUISICAO_PENDENTE_AUTORIZACAOs" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
			<otm:commandIcon action="#{PainelGestorCompraControle.inicializarDadosEstatisticaRequisicoes}" status="stsRequisicao" oncomplete="iniciarPollRequisicao()" render="REQUISICAO_PENDENTE_AUTORIZACAO" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard" id="btnAtualizarGraficoREQUISICAO_PENDENTE_AUTORIZACAO" />

		</ui:define>
		<ui:define name="body">
			<h:panelGroup layout="block" styleClass="row scroller-x" rendered="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado}" style="height:297px;overflow-x:auto">
				<script type="text/javascript" charset="UTF-8">
			(function($) {
				$(document).ready(function() {	
					iniciarPollRequisicao();
// 					criarGraficoRequisicao();																
				});
			
				iniciarPollRequisicao = function(){	
					if(#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado}){						
						setTimeout(validarPoolRequisicaoEncerrado(), 1000);
						iniciarCriacaoGraficoRequisicao();						
					}else{
						iniciarCriacaoGraficoRequisicao();
						
					}
				};
				
				iniciarCriacaoGraficoRequisicao = function(){						
						if(#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').maximizado} &amp;&amp; #{!empty PainelGestorCompraControle.valorGraficoRequisicao}){
							criarGraficoRequisicao();
						}					
				};

			}(jQuery));
		</script>
				
				<a4j:jsFunction  execute="@region" immediate="true" name="validarPoolRequisicaoEncerrado" status="pollRequisicao"  action="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').encerrarDashboard}"
				oncomplete="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado ? 'iniciarCriacaoGraficoRequisicao()' : 'iniciarPollRequisicao()' }" render="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado ? 'REQUISICAO_PENDENTE_AUTORIZACAO' : ''}"></a4j:jsFunction>
				
					<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado}" 
					styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
						<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
							<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
						</h:panelGroup>
					</h:panelGroup>
				<h:panelGroup styleClass="row text-center" rendered="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado and !empty PainelGestorCompraControle.valorGraficoRequisicao}" layout="block">
					<h:panelGroup layout="block" id="chartRequisicoes" styleClass="col-md-12 text-center">
						<script type="text/javascript" charset="UTF-8">
			(function($) {
				$(document).ready(function() {						
 					criarGraficoRequisicao();																
				});
				
				criarGraficoRequisicao = 	function() {
                         
                          var options = {
                              exporting:{
                                  type: 'image/jpeg',
                                  buttons:{
                                      exportButton:{
                                          y:5
                                      },
                                      printButton:{
                                          y:5
                                      }
                                  }
                              },
                              title : {
									text :''
							  },
                              legend:{
                                  enabled : false,
                                  marginTop: 5,
                                  style:{
                                      fontSize:10
                                  }
                              },
                              chart : {
                                  type : "column",
                                  renderTo : "form\:chartRequisicoes",                                                                   
                                  height:230                                  
                              },
                              credits : {
                                  enabled : false
                              },
                                                         
                              xAxis:{
                                  categories:[${PainelGestorCompraControle.valorCategoriaRequisicao}]
                              },
                              yAxis: {
                                  title:{
                                      text:''
                                  },
                                  labels: {
                                      formatter: function() {
                                          return this.value;
                                      },
                                      style:{
                                          fontSize: '10px'
                                      }
										        
                                  }
                              },
                              tooltip : {
                                  formatter: function() {
                                      return this.x +' - '+ this.y;
                                  }
                              },
																								
                              series : [{color:'#36b9cc',data:[ ${PainelGestorCompraControle.valorGraficoRequisicao}]}]
										
                          };
                          var chartRequis = new Highcharts.Chart(options);
								
                      }
				

			}(jQuery));
		</script>
				
					
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup styleClass="row text-center mt50" rendered="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado and empty PainelGestorCompraControle.valorGraficoRequisicao}" layout="block">
					<h:outputText value="Nenhum registro encontrado para a geração deste painel"></h:outputText>
				</h:panelGroup>

				<h:panelGroup styleClass="col-md-12" layout="block" rendered="#{!LoginControle.mapDashboards.get('REQUISICAO_PENDENTE_AUTORIZACAO').ativado and !empty PainelGestorCompraControle.valorGraficoRequisicao}">
					<rich:dataTable style="border:none" id="dataTableRequisicoes" width="100%" cellpadding="0" cellspacing="0" border="none" rowClasses="columnSemBorda" columnClasses="columnSemBorda" value="#{PainelGestorCompraControle.estatisticaRequisicaoVO.resumoCronologico}" rows="10" var="linhaRequisicao">
						<rich:column>
							<h:outputText value="#{linhaRequisicao.descricao}" />
						</rich:column>
						<rich:column>
							<h:outputText value="#{linhaRequisicao.quantidade}" />
						</rich:column>
						<f:facet name="footer">
							<div style="text-align: center !important">
								<rich:dataScroller resetValues="true" limitRender="true" boundaryControls="auto" stepControls="auto" fastControls="hide" align="center" for="dataTableRequisicoes" />
							</div>
						</f:facet>
					</rich:dataTable>
				</h:panelGroup>

			</h:panelGroup>
		</ui:define>
	</otm2:dashpanel>
</h:panelGroup>



</html>