<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://xmlns.jcp.org/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br">

<h:panelGroup id="EMPRESTIMOS_BIBLIOTECA" style="order:#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ordem}" layout="block" styleClass="col-md-6" rendered="#{AplicacaoControle.cliente.permitirAcessoModuloBiblioteca and PainelGestorBibliotecaControle.perfilAcessoPainelEmpretimoBiblioteca and LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA') != null and !LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ocultar }">
	<rich:dropTarget dropValue="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA')}" render=":form:panelGeral" dropListener="#{LoginControle.registrarPosicaoDashboard}" acceptedTypes="DASHBOARDS" />
	<rich:dragSource type="DASHBOARDS" dragIndicator="EMPRESTIMOS_BIBLIOTECA_DRAG" dragValue="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA')}">
	</rich:dragSource>
	<otm2:dashpanel id="dashboardEmprestimos" cols="12">
		<ui:define name="header">
			<i class="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').icone} mr-2 fs12"></i>
			<h:outputLabel styleClass="fs12 fonteHeaderDashboard" value="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').titulo}" />
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA'))}" rendered="#{!LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-down text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA'))}" rendered="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').maximizado}" styleClass="float-right p-0" render="panelGeral"> -->
<!-- 				<i class="fas fa-angle-up text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="false" target="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').maximizado}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
<!-- 			<a4j:commandLink id="ocultarEMPRESTIMOS_BIBLIOTECAs" action="#{LoginControle.persistirDashboard(LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA'))}" render=":form:menuTopo, :form:panelGeral" styleClass="border-0 bg-transparent float-right p-0" title="Ocultar Gráfico"> -->
<!-- 				<i class="fas fa-compress-arrows-alt text-center fonteHeaderDashboard mr-2 fs12" /> -->
<!-- 				<f:setPropertyActionListener value="true" target="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ocultar}"></f:setPropertyActionListener> -->
<!-- 			</a4j:commandLink> -->
			<otm:commandIcon action="#{PainelGestorBibliotecaControle.inicializarDadosPainelBiblioteca}" status="stsBibi" oncomplete="iniciarPollEmprestimo()" render="EMPRESTIMOS_BIBLIOTECA" icon="#{msg_botoes.btn_icon_atualizar_embutido}" styleClass="border-0 bg-transparent float-right p-0 mr10 fonteHeaderDashboard" id="btnAtualizarGraficoEMPRESTIMOS_BIBLIOTECA" />

		</ui:define>
		<ui:define name="body">
			<h:panelGroup layout="block" styleClass="row scroller-x" rendered="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').maximizado}" style="height:297px;overflow-x:auto">

				<a4j:jsFunction  execute="@region" immediate="true" name="validarPoolEmprestimoEncerrado" status="pollCompra" action="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').encerrarDashboard}" oncomplete="#{!LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado ? '' : 'iniciarPollEmprestimo()' }" render="#{!LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado ? 'EMPRESTIMOS_BIBLIOTECA' : ''}"></a4j:jsFunction>


				<h:panelGroup layout="block" rendered="#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado}" styleClass="w-100 bg-dark text-center" style="text-align:center;height:297px;opacity: 0.2;">
					<h:panelGroup layout="block" styleClass="loading-icon" style="position:relative;top:43%;left:47%;width:60px;height:60px">
						<h:graphicImage value="#{resource['imagens/logo_sei_cinza.png']}" style="width:60px;" />
					</h:panelGroup>
				</h:panelGroup>

				<script type="text/javascript" charset="UTF-8">
	(function($) {
		$(document).ready(function() {																		
			iniciarPollEmprestimo();																								
		});	
		iniciarPollEmprestimo = function(){	
			if(#{LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado}){						
				setTimeout(validarPoolEmprestimoEncerrado(), 1000);			
			}
		}
	}(jQuery));
	</script>

				<h:panelGroup layout="block" rendered="#{!LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado and empty PainelGestorBibliotecaControle.emprestimoVOs}" styleClass="w-100 text-center mt50">
					<h:outputText value="Nenhum registro encontrado para a geração deste painel"></h:outputText>
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{!LoginControle.mapDashboards.get('EMPRESTIMOS_BIBLIOTECA').ativado and !empty PainelGestorBibliotecaControle.emprestimoVOs}" styleClass="row ">
					<a4j:repeat id="items" value="#{PainelGestorBibliotecaControle.emprestimoVOs}" var="emprestimoItens">
						<h:panelGroup layout="block" styleClass="col-md-4 p5">
							<otm2:panel name="emp" renderedControl="false" styleClassFooter="dn">
								<ui:define name="header">
									<h:outputText value="#{emprestimoItens.biblioteca.nome}" />
								</ui:define>
								<ui:define name="body">
									<h:panelGroup layout="block" styleClass="col-md-12 text-center">
										<h:outputText styleClass="fs10 text-success btn-block" value="Empréstimos Ativos" />
										<h:outputText  styleClass="fs20 text-success btn-block" value="#{emprestimoItens.qtdAtivo}" />
									</h:panelGroup>
									<h:panelGroup layout="block" styleClass="col-md-12 text-center mt10">
										<h:outputText styleClass="fs10 btn-block text-danger" value="Empréstimos Atrasados" />
										<a4j:commandLink oncomplete="abrirPopup('../biblioteca/emprestimoCons.xhtml', 'emprestimoCons', 930, 595);" action="#{PainelGestorBibliotecaControle.editarEmprestimoAtrasado}" id="qtdAtrasado" >
											<h:outputText styleClass="fs20 btn-block text-danger" value="#{emprestimoItens.qtdAtrasado}" />
										</a4j:commandLink>
										
									</h:panelGroup>
								</ui:define>
							</otm2:panel>
						</h:panelGroup>
					
					</a4j:repeat>
					
				</h:panelGroup>
			</h:panelGroup>
		</ui:define>
	</otm2:dashpanel>
</h:panelGroup>

</html>
