<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:otm="http://java.sun.com/jsf/composite/otm" xmlns:otm2="http://www.otimize-ti.com.br">

<ui:composition template="/visaoAdministrativo/template/visaoAdministrativa.xhtml">
	<ui:define name="tituloPagina">
		<h:outputText value="#{msg_aplic.prt_PainelGestor_tituloForm}" />
	</ui:define>
	<ui:define name="conteudo">

		<h:form id="form">
			<h:panelGroup layout="block" styleClass="row">
				<rich:panel id="panelFiltroUnidadeEnsino">
					<f:facet name="header">
						<h:panelGroup layout="block" styleClass="p5">
							<i class="fas fa-filter mr5"></i>
							<h:outputText rendered="#{PainelGestorControle.filtrarUnidadeEnsino}" styleClass="tituloCamposReduzidosNegritoItalicoCinza" value="Ocultar Filtros" />
							<h:outputText rendered="#{!PainelGestorControle.filtrarUnidadeEnsino}" styleClass="tituloCamposReduzidosNegritoItalicoCinza" value="Apresentar Filtros" />

							<otm:commandIcon rendered="#{!PainelGestorControle.filtrarUnidadeEnsino}" styleClass="float-right mr10" action="#{PainelGestorControle.setFiltrarUnidadeEnsino(true)}" render="panelFiltroUnidadeEnsino" icon="fas fa-expand-alt fs14">

							</otm:commandIcon>
							<otm:commandIcon rendered="#{PainelGestorControle.filtrarUnidadeEnsino}" styleClass="float-right mr10" action="#{PainelGestorControle.setFiltrarUnidadeEnsino(false)}" render="panelFiltroUnidadeEnsino" icon="fas fa-compress-alt fs14">

							</otm:commandIcon>


						</h:panelGroup>
					</f:facet>
					<h:panelGroup layout="block" rendered="#{PainelGestorControle.filtrarUnidadeEnsino}" styleClass="row">
						<h:panelGroup layout="block" styleClass="col-md-3">
							<h:outputText styleClass="field control-label tituloCampos" value="#{msg_aplic.prt_PainelGestor_periodoDe}" />

							<otm:calendar id="dataInicio" showWeekDaysBar="false" showWeeksBar="false" showFooter="false" locale="pt_BR" oninputkeypress="return mascara(this.form, this.id, '99/9999', event);" onchanged="return renderData(this.id)" oninputchange="validarDataMesAno(this.value,this.id)" enableManualInput="true" datePattern="MM/yyyy" inputClass="form-control campos" inputSize="7" styleClass="form-control camposObrigatorios" value="#{PainelGestorControle.dataInicioMesAno}" />
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="col-md-3">

							<h:outputText styleClass="field control-label tituloCampos" value="#{msg_aplic.prt_PainelGestor_ate}" />
							<otm:calendar id="dataTermino" showWeekDaysBar="false" showWeeksBar="false" showFooter="false" locale="pt_BR" oninputkeypress="return mascara(this.form, this.id, '99/9999', event);" onchanged="return renderData(this.id)" oninputchange="validarDataMesAno(this.value,this.id)" enableManualInput="true" datePattern="MM/yyyy" inputClass="form-control campos" inputSize="7" styleClass="form-control camposObrigatorios" value="#{PainelGestorControle.dataFinalMesAno}" />
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="col-md-3">


							<h:outputText styleClass="tituloCampos btn-block" value="Trazer Contas Pagas" />
							<otm:selectBooleanCheckbox id="trazerContasPagas" value="#{PainelGestorControle.painelGestorVO.trazerContasPagas}" />
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="col-md-3">
							<h:outputText styleClass="tituloCampos btn-block" value="Trazer Contas a Pagar" />
							<otm:selectBooleanCheckbox id="trazerContasAPagar" value="#{PainelGestorControle.painelGestorVO.trazerContasAPagar}" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" rendered="#{PainelGestorControle.filtrarUnidadeEnsino}" styleClass="row">
						<h:panelGroup layout="block" styleClass="row ">
							<h:panelGroup layout="block" styleClass="title">
								<h:outputText value="Selecionar Unidades de Ensino" />
								<otm:selectBooleanCheckbox id="marcarTodasUnidadeEnsino" styleClass="float-right" value="#{PainelGestorControle.marcarTodasUnidadeEnsino}">
									<a4j:ajax event="change" listener="#{PainelGestorControle.marcarTodasUnidadesEnsinoAction}" render="form" />
								</otm:selectBooleanCheckbox>
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="row ">
								<a4j:repeat id="filtros" var="unidadeEnsinoItens" value="#{PainelGestorControle.unidadeEnsinoVOs}">
									<h:panelGroup layout="block" styleClass="col-md-4">
										<h:outputText value="#{unidadeEnsinoItens.nome}" styleClass="tituloCampos btn-block" />
										<otm:selectBooleanCheckbox id="unidade#{unidadeEnsinoItens.codigo}" value="#{unidadeEnsinoItens.filtrarUnidadeEnsino}">
										</otm:selectBooleanCheckbox>
									</h:panelGroup>
								</a4j:repeat>
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>


					<h:panelGroup layout="block" styleClass="row text-center">
						<a4j:commandLink value="Gerar Relatório" render="form" styleClass="btn btn-default mr5" oncomplete="criarGraficoCategoriaDespesaPie();" action="#{PainelGestorControle.consultarDadosPainelGestorCategoriaDespesa}">
							<i class="fas fa-chart-pie pull-left" style="margin-right: 0.8em; font-size: 14px; margin-top: 2px;"></i>
							<f:setPropertyActionListener target="#{PainelGestorControle.mesAno}" value="" />
						</a4j:commandLink>

						<a4j:commandLink value="#{msg_botoes.btn_monitorarAcademico}" title="#{msg_botoes.btn_monitorarAcademico}" styleClass="btn btn-info" rendered="#{LoginControle.permissaoAcessoMenuVO.painelGestorAcademico}" action="#{PainelGestorControle.consultarDadosMonitoramentoAcademico}">
							<i class="fas fa-university pull-left" style="margin-right: 0.8em; font-size: 14px; margin-top: 2px;"></i>
							<f:setPropertyActionListener target="#{PainelGestorControle.telaOrigem}" value="PAINEL_GESTOR_CATEGORIA_DESPESA" />
						</a4j:commandLink>

						<otm:commandButton icon="#{msg_botoes.btn_icon_voltar}" styleClass="btn  btn-default ml5" value="Voltar Tela Inicial" action="#{PainelGestorControle.voltarPagina}" />
					</h:panelGroup>
				</rich:panel>
			</h:panelGroup>


			<a4j:commandButton oncomplete="criarGraficoCategoriaDespesaPie();" style="cursor:pointer;display:none" id="atualizarListaNiveis" render="form">
			</a4j:commandButton>

			<h:panelGroup id="niveis" styleClass="row" layout="block" style="position:relative;left:190px;z-index:1000;top:20px;padding:0;">
				<h:outputText rendered="#{!empty PainelGestorControle.painelGestorVO.listaNivelGraficoCategoriaDespesa}" styleClass="tituloCamposNavegacao" value=" - " />
				<otm:spacer width="5px" />
				<ui:repeat var="nivel" value="#{PainelGestorControle.painelGestorVO.listaNivelGraficoCategoriaDespesa}" >
					<h:panelGroup layout="block">
						<h:commandLink styleClass="tituloCamposNavegacao" rendered="#{nivel ne 'início'}" action="#{PainelGestorControle.consultarDadosPainelGestorCategoriaDespesa}">
							<h:outputText styleClass="tituloCamposNavegacao" style="font-size:14px;padding-bottom:5px;font-weight:bold" value="#{nivel}" />
							<f:setPropertyActionListener value="#{nivel}" target="#{PainelGestorControle.painelGestorVO.nivelAtualCategoriaDespesa}" />
						</h:commandLink>
						<h:commandLink styleClass="tituloCamposNavegacao" rendered="#{nivel eq 'início'}" action="#{PainelGestorControle.consultarDadosPainelGestorCategoriaDespesa}">
							<h:outputText styleClass="tituloCamposNavegacao" style="font-size:14px;padding-bottom:5px;font-weight:bold" value="#{nivel}" />
							<f:setPropertyActionListener value="" target="#{PainelGestorControle.painelGestorVO.nivelAtualCategoriaDespesa}" />
						</h:commandLink>
						<otm:spacer width="5px" />
						<h:outputText styleClass="tituloCamposNavegacao" style="font-size:14px;padding-bottom:5px;font-weight:bold" value=" / " />
						<otm:spacer width="5px" />
					</h:panelGroup>
				</ui:repeat>
			</h:panelGroup>


			<h:panelGroup layout="block" styleClass="row">
				<otm2:dashpanel id="panelGrafDesp" cols="8">
					<ui:define name="header">
						<i class="fas fa-chart-pie mr5"></i>
						<h:outputText value="Despesa Por Categoria"></h:outputText>
					</ui:define>
					<ui:define name="body">
						<script type="text/javascript" charset="UTF-8">
								(function($) {
									$.ajaxSetup({
										cache : false
									});

									$(document).ready(function() {
										criarGraficoCategoriaDespesaPie();
									});

									$(window).resize(function() {
										resize();																			
									});
									$(window).ready(function() {
										resize();										
									});
									resize = function() {										
										$('.autoresizeGrafico').each(
												function() {
													$(this).attr('style','width:'+ ($(window).width() - 50)+ 'px !important;float:left;padding-left:10px');
												});																			
									};

									criarGraficoCategoriaDespesaPie = function() {

										var options = {
											exporting : {
												type : 'image/jpeg',
												buttons : {
													exportButton : {
														y : 5

													},
													printButton : {
														y : 5
													}
												}
											},
											chart : {
												type : "pie",
												renderTo : "form\:graficoCategoriaDespesaPie",
												backgroundColor : "#FFF",
												marginTop : 40,
												spacingLeft : 0,
												height : 350
											},
											credits : {
												enabled : false
											},
											title : {
												text : '',
												align : 'left',
												useHTML : true,
												y : 5
											},
											plotOptions : {
												pie : {
													allowPointSelect : true,
													cursor : 'pointer',
													point : {
														events : {
															click : function(e) {
																click: consultarDadosGraficoCategoriaDespesa(this.nivel)
															},
															legendItemClick : function(
																	e) {
																click: consultarDadosGraficoCategoriaDespesa(this.nivel)
															}

														}
													},
													dataLabels : {
														enabled : true,
														formatter : function() {
															return this.point.nivel
																	+ '- <b>'
																	+ this.point.y
																	+ '%</b>';
														}
													},
													showInLegend : true

												}
											},
											legend : {

												labelFormatter : function() {
													return this.nome + ': <b>'
															+ this.y
															+ '%</b>';
												},
												layout : 'vertical',
												align : 'right',
												verticalAlign : 'top',
												y : 50,
												x : -10,
												itemWidth : 400
											},
											tooltip : {
												formatter : function() {
													return '<b>'
															+ this.point.nome
															+ ' - '
															+ this.point.valor
															+ '</b>: '
															+ this.point.y
															+ '%';
												}
											},

											series : [ {
												visible : ${PainelGestorControle.montarGraficoCategoriaDespesaVisible},
												data : [ ${PainelGestorControle.montarDataGraficoCategoriaDespesa} ]
											} ]
										};
										var chart3 = new Highcharts.Chart(
												options);
									};

								}(jQuery));
							</script>

						<h:panelGroup id="graficoCategoriaDespesaPie" layout="block" styleClass="col-md-12">
						</h:panelGroup>

						<a4j:jsFunction name="consultarDadosGraficoCategoriaDespesa" action="#{PainelGestorControle.consultarDadosPainelGestorCategoriaDespesa}">
							<a4j:param name="param1" assignTo="#{PainelGestorControle.painelGestorVO.nivelAtualCategoriaDespesa}" />
						</a4j:jsFunction>
					</ui:define>
				</otm2:dashpanel>




				<h:panelGroup layout="block" styleClass="col-md-4">
					<h:panelGroup layout="block" rendered="#{PainelGestorControle.painelGestorVO.trazerContasPagas}" styleClass="col-md-12">
						<otm2:panel name="panelTotalPG" renderedControl="false" styleClassFooter="dn" stylePanel="min-height: 105px;">
							<ui:define name="header">
								<h:outputText styleClass="text-success" value="Total Pago No Período" />
							</ui:define>
							<ui:define name="body">
								<h:panelGroup layout="block" styleClass="col-md-12 text-center">
									<h:outputText rendered="#{PainelGestorControle.painelGestorVO.trazerContasPagas}" styleClass="text-success fs20" value="#{PainelGestorControle.painelGestorVO.valorTotalPagoPorCategoriaDespesa}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</h:panelGroup>
							</ui:define>
						</otm2:panel>
					</h:panelGroup>

					<h:panelGroup layout="block" rendered="#{PainelGestorControle.painelGestorVO.trazerContasAPagar}" styleClass="col-md-12">
						<otm2:panel name="panelTotalAPPer" renderedControl="false" styleClassFooter="dn" stylePanel="min-height: 105px;">
							<ui:define name="header">
								<h:outputText styleClass="text-danger" value="Total a Pagar No Período" />
							</ui:define>
							<ui:define name="body">
								<h:panelGroup layout="block" styleClass="col-md-12 text-center">
									<h:outputText rendered="#{PainelGestorControle.painelGestorVO.trazerContasAPagar}" styleClass="text-danger fs20" value="#{PainelGestorControle.painelGestorVO.valorTotalPagarPorCategoriaDespesa}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</h:panelGroup>
							</ui:define>
						</otm2:panel>
					</h:panelGroup>

					<h:panelGroup layout="block" rendered="#{PainelGestorControle.painelGestorVO.trazerContasPagas and PainelGestorControle.painelGestorVO.trazerContasAPagar}" styleClass="col-md-12">
						<otm2:panel name="panelTotalAP" renderedControl="false" styleClassFooter="dn" stylePanel="min-height: 105px;">
							<ui:define name="header">
								<h:outputText styleClass="text-info" value="Total Geral" />
							</ui:define>
							<ui:define name="body">
								<h:panelGroup layout="block" styleClass="col-md-12 text-center">
									<h:outputText rendered="#{PainelGestorControle.painelGestorVO.trazerContasPagas and PainelGestorControle.painelGestorVO.trazerContasAPagar}" styleClass="text-info  fs20" value="#{PainelGestorControle.painelGestorVO.valorTotalPorCategoriaDespesa}">
										<f:converter converterId="FormatadorNumerico" />
									</h:outputText>
								</h:panelGroup>
							</ui:define>
						</otm2:panel>
					</h:panelGroup>
				</h:panelGroup>
			</h:panelGroup>


			<h:panelGroup layout="block" id="panelContasAPagar" styleClass="row row-overflow mt10">

				<rich:dataTable id="contasPagarVOs" rowKeyVar="row" headerClass="consulta" width="100%" rows="50" rendered="#{PainelGestorControle.controleConsultaOtimizado.apresentarListaConsulta}" value="#{PainelGestorControle.controleConsultaOtimizado}" var="contaPagarItens">
					<f:facet name="header">
						<rich:columnGroup>
							<rich:column width="100%" colspan="11">
								<h:outputText value="Contas a pagar da categoria de despesa: #{PainelGestorControle.categoriaDespesaVO.identificadorCategoriaDespesa} - #{PainelGestorControle.categoriaDespesaVO.descricao}" />
							</rich:column>
							<rich:column width="5%" rowspan="2" breakRowBefore="true">
								<h:outputText value="Nr" />
							</rich:column>
							<rich:column width="5%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_codigo}" />
							</rich:column>
							<rich:column width="25%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_fornecedor_funcionario_banco}" />
							</rich:column>
							<rich:column width="5%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_situacao}" />
							</rich:column>
							<rich:column width="5%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_dataVencimento}" />
							</rich:column>
							<rich:column width="5%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_valor}" />
							</rich:column>
							<rich:column width="15%" rowspan="2">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_unidadeEnsino}" />
							</rich:column>
							<rich:column colspan="4" width="40%">
								<h:outputText value="Centro Resultado Origem" />
							</rich:column>
							<rich:column style="width:13.5%" breakRowBefore="true">
								<h:outputText value="#{msg_aplic.prt_ContaPagar_categoriaDespesa}" />
							</rich:column>
							<rich:column style="width:13.5%">
								<h:outputText value="Centro Resultado" />
							</rich:column>
							<rich:column style="width:6%; min-width: 30px">
								<h:outputText value="%" />
							</rich:column>
							<rich:column style="width:7%; min-width: 30px">
								<h:outputText value="R$" />
							</rich:column>
						</rich:columnGroup>
					</f:facet>
					<rich:column>
						<h:outputText id="rowNr" value="#{row+1}" />
					</rich:column>
					<rich:column>
						<h:outputText id="codigo" value="#{contaPagarItens.codigo}" />
					</rich:column>
					<rich:column style="text-align:left">
						<h:outputText id="favorecido" value="#{contaPagarItens.favorecido}" />
					</rich:column>
					<rich:column>
						<h:outputText id="situacao" value="#{contaPagarItens.situacao_Apresentar}" />
					</rich:column>
					<rich:column>
						<h:outputText id="dataVencimento" value="#{contaPagarItens.dataVencimento_Apresentar}" />
					</rich:column>

					<rich:column style="text-align:right">
						<h:outputText value="#{contaPagarItens.valor}">
							<f:converter converterId="FormatadorNumerico" />
						</h:outputText>

					</rich:column>
					<rich:column>
						<h:outputText id="unidadeEnsino" value="#{contaPagarItens.unidadeEnsino.nome}" />

					</rich:column>
					<rich:column colspan="4" style="padding:0px !important">
						<rich:dataTable rowKeyVar="row" style="border:none;padding:0px !important; width:100%;margin:0px !important" columnClasses="semBordaSemMargin, semBordaSemMargin, semBordaSemMargin, semBordaSemMargin" value="#{contaPagarItens.listaCentroResultadoOrigemVOs}" var="centroResultadoOrigemItem">
							<rich:column style="width:33.5%;padding:2px !important; text-align:left #{row > 0 ? ';border-top:1px solid #C4C0C9 !important' : ''}">
								<h:outputText value="#{centroResultadoOrigemItem.categoriaDespesaVO.descricao}" />
							</rich:column>
							<rich:column style="width:33.5%;padding:2px !important; text-align:left; border-left:1px solid #C4C0C9 !important #{row > 0 ? ';border-top:1px solid #C4C0C9 !important' : ''}">
								<h:outputText value="#{centroResultadoOrigemItem.centroResultadoAdministrativo.descricao}" />
							</rich:column>
							<rich:column style="width:14.5%;padding:2px !important; border-left:1px solid #C4C0C9 !important #{row > 0 ? ';border-top:1px solid #C4C0C9 !important' : ''}">
								<h:outputText value="#{centroResultadoOrigemItem.porcentagem}">
									<f:converter converterId="FormatadorNumerico" />
								</h:outputText>
							</rich:column>
							<rich:column style="width:17.5%;padding:2px !important; text-align:right; border-left:1px solid #C4C0C9 !important #{row > 0 ? ';border-top:1px solid #C4C0C9 !important' : ''}">
								<h:outputText value="#{centroResultadoOrigemItem.valor}">
									<f:converter converterId="FormatadorNumerico" />
								</h:outputText>
							</rich:column>
						</rich:dataTable>
					</rich:column>


					<f:facet name="footer">
						<div style="text-align: center !important">
							<rich:dataScroller stepControls="auto" fastControls="hide" boundaryControls="auto" align="center" for="contasPagarVOs" id="paginadorBottom" page="#{PainelGestorControle.controleConsultaOtimizado.page}" scrollListener="#{PainelGestorControle.scrollContaPagarCategoriaDespesa}" rendered="#{PainelGestorControle.controleConsultaOtimizado.apresentarPaginador}" render="contasPagarVOs, paginadorTop" status="false" />
						</div>
					</f:facet>
				</rich:dataTable>
			</h:panelGroup>
		</h:form>
	</ui:define>
</ui:composition>
</html>