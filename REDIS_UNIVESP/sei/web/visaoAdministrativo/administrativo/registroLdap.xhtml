<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:otm="http://java.sun.com/jsf/composite/otm">

<h:head>
    <style>
        table {
            width: 100%;
        }
    </style>
    <script type="text/javascript">
        window.onload = function () {
            document.getElementById("formCadastro:valorConsulta").focus();
        }
    </script>
</h:head>

<ui:composition template="/visaoAdministrativo/template/visaoAdministrativa.xhtml">
    <ui:define name="tituloPagina">
        <h:outputText value="#{msg_aplic.prt_RegistroLdap_tituloForm}"/>
    </ui:define>

    <ui:define name="conteudo">
        <h:form id="formCadastro">
            <h:commandLink action="#{RegistroLdapControle.liberarBackingBeanMemoria}"
                           immediate="true"
                           id="idLiberarBackingBeanMemoria"
                           style="display: none"/>
            <h:panelGroup layout="block"
                          styleClass="col-md-12">
                <h:outputText styleClass="field control-label tituloCampos"
                              value="#{msg.msg_consultar_por}"/>
            </h:panelGroup>
            <h:panelGroup layout="block"
                          styleClass="col-md-2">
                <h:selectOneMenu styleClass="form-control campos"
                                 id="consulta"
                                 required="true"
                                 value="#{RegistroLdapControle.controleConsultaOtimizado.campoConsulta}">
                    <f:selectItems value="#{RegistroLdapControle.tipoConsultaCombo}"/>
                </h:selectOneMenu>
            </h:panelGroup>
            <h:panelGroup layout="block"
                          styleClass="col-md-4">
                <h:inputText id="valorConsulta"
                             styleClass="form-control campos ml5"
                             value="#{RegistroLdapControle.controleConsultaOtimizado.valorConsulta}"/>
            </h:panelGroup>
            <h:panelGroup layout="block"
                          styleClass="col-md-2">
                <otm:commandButton id="consultar"
                                   type="submit"
                                   render="formCadastro"
                                   value="#{msg_botoes.btn_consultar}"
                                   action="#{RegistroLdapControle.consultar(1)}"
                                   accesskey="2"
                                   styleClass="btn btn-default btn-consultar"/>
            </h:panelGroup>
            <h:panelGroup layout="block"
                          styleClass="row">
                <rich:dataTable id="items"
                                width="100%"
                                headerClass="consulta"
                                columnClasses="colunaAlinhamento"
                                value="#{RegistroLdapControle.controleConsultaOtimizado}"                                
                                rows="10"
                                var="registroLdapItem">
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_RegistroLdap_codigo}"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.codigo}"/>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_RegistroLdap_data}"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.data}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                        </h:outputText>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_CriterioAvaliacaoAluno_matricula}"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.matricula.matricula}"/>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_Curso_tituloForm}"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.matricula.curso.nome}"/>
                    </rich:column>
                   
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_Matricula_nomeAluno}/Pessoa"/>
                        </f:facet>
                        <h:outputText rendered="#{registroLdapItem.matricula.aluno.codigo ne 0}" value="#{registroLdapItem.matricula.aluno.nome}"/>
                        <h:outputText rendered="#{registroLdapItem.pessoaVO.codigo ne 0 and registroLdapItem.matricula.aluno.codigo eq 0}" value="#{registroLdapItem.pessoaVO.nome}"/>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="Email"/>
                        </f:facet>                        
                        <h:outputText value="#{registroLdapItem.pessoaEmailInstitucionalVO.email}"/>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_ConfiguracaoGeralSistema_dominio}"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.configuracaoLdap.dominio}"/>
                    </rich:column>
                     <rich:column>
                        <f:facet name="header">
                            <h:outputText value="Operação"/>
                        </f:facet>
                        <h:outputText value="#{registroLdapItem.operacao_Apresentar}"/>
                    </rich:column>
                    
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_aplic.prt_RegistroLdap_sucesso}"/>
                        </f:facet>
                        <h:outputText id="sucesso"
                                      value="#{registroLdapItem.sucesso ? 'Sucesso' : 'Falha'}"/>
                        <rich:tooltip value="#{registroLdapItem.excessao}"
                                      rendered="#{!registroLdapItem.sucesso}"/>
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText value="#{msg_botoes.btn_opcoes}"/>
                        </f:facet>
                        <otm:commandIcon action="#{RegistroLdapControle.regerar}"
                                         icon="#{msg_botoes.btn_icon_atualizar} iconePequeno"
                                         tooltip="Regerar"
                                         render="@form"
                                         rendered="#{!registroLdapItem.sucesso}"/>
                    </rich:column>
                    <f:facet name="footer">
                        <rich:dataScroller boundaryControls="auto"
                                           fastControls="hide"
                                           stepControls="auto"
                                           for="items"
                                           scrollListener="#{RegistroLdapControle.scrollListener}"
                                           limitRender="10"
                                           align="center"/>
                    </f:facet>
                </rich:dataTable>
            </h:panelGroup>
            <h:panelGroup columns="1"
                          width="100%"
                          styleClass="tabMensagens">
                <h:panelGroup columns="1"
                              width="100%"
                              columnClasses="colunaEsquerda">
                    <otm:mensagem bean="#{RegistroLdapControle}" />
                </h:panelGroup>
            </h:panelGroup>
        </h:form>
    </ui:define>
</ui:composition>
</html>